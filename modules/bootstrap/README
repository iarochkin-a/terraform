
# Terraform Bootstrap Module (Selectel)

–ú–æ–¥—É–ª—å **bootstrap** –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Selectel –¥–ª—è Terraform-–ø—Ä–æ–µ–∫—Ç–∞.

–û–Ω —Å–æ–∑–¥–∞—ë—Ç:

* **Selectel Project** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –≤ –æ–±–ª–∞–∫–µ, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è –≤—Å—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.
* **Service User** ‚Äî —Å–µ—Ä–≤–∏—Å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Terraform –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏.

–ú–æ–¥—É–ª—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ **–ø–µ—Ä–≤–∏—á–Ω—ã–π root module**. –ü–æ—Å–ª–µ –µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (network, compute, s3 –∏ —Ç.–¥.) –±–µ–∑ —Ä–∏—Å–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
modules/bootstrap/
‚îú‚îÄ‚îÄ main.tf        # –†–µ—Å—É—Ä—Å—ã Selectel: project –∏ service user
‚îú‚îÄ‚îÄ variables.tf   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ outputs.tf     # –í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: project_id, service_user_name, service_user_password
‚îî‚îÄ‚îÄ versions.tf    # –¢—Ä–µ–±—É–µ–º—ã–π provider selectel
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (tfvars)

### 1Ô∏è‚É£ Selectel authentication

```hcl
selectel_domain_name = "–≤–∞—à Selectel Account ID"
selectel_username    = "–∏–º—è –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–∞–Ω–µ–ª–∏ my.selectel"
selectel_password    = "–ø–∞—Ä–æ–ª—å —Å–µ—Ä–≤–∏—Å–Ω–æ–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
selectel_auth_region = "—Ä–µ–≥–∏–æ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä ru-7"
provider_auth_url    = "https://cloud.api.selcloud.ru/identity/v3/"
```

–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Selectel API —á–µ—Ä–µ–∑ Terraform provider.

---

### 2Ô∏è‚É£ Selectel project –∏ service user

```hcl
project_name           = "–∏–º—è —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞"
service_user_name      = "–∏–º—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Terraform"
service_user_password  = "–ø–∞—Ä–æ–ª—å —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
```

* **project_name** ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Selectel, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å Terraform.
* **service_user_name** ‚Äî —Å–µ—Ä–≤–∏—Å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Terraform –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞.
* **service_user_password** ‚Äî –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üì§ Outputs

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–¥—É–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ outputs:

| Output                  | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| ----------------------- | ------------------------------------------ |
| `project_id`            | ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ Selectel –ø—Ä–æ–µ–∫—Ç–∞             |
| `service_user_name`     | –ò–º—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                |
| `service_user_password` | –ü–∞—Ä–æ–ª—å —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (sensitive) |

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è

–ü—Ä–∏–º–µ—Ä –≤ root bootstrap:

```hcl
module "bootstrap" {
  source = "../modules/bootstrap"

  project_name          = var.project_name
  service_user_name     = var.service_user_name
  service_user_password = var.service_user_password
}
```

–ó–∞—Ç–µ–º:

```bash
cd bootstrap
terraform init
terraform plan
terraform apply
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `apply` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `terraform output` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `project_id` –∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π.